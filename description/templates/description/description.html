{% extends 'base.html' %}
{% load static %}
{% load cache %}

{%block titre%} {{titre|title}} - Description {%endblock titre %}

{%block style %}
<style>
    .container{
        padding: 75px 25%;
        border: 10px solid red;
    }
    .progress{
        margin: 10px;
    }
    .etoile{
        display: grid;
        place-content: center;
    }
</style>
{%endblock style %}
{%block links %} 
<link rel="stylesheet" href="{% static 'description/css/style-description.css' %}">
<link rel="stylesheet" href="{% static 'owl-carrousel/css/card-style.css' %}">
{%endblock links %}
{%block Connexion %}
    {% if uid %}
        {% include "header/nav_connexion.html" %}
   {% else %}
      {% include "header/nav.html" %}
   {% endif %}
{%endblock Connexion %}
{% block Content %}

{%for dat,user,dispo,avis in data %}
<div class="container-annonces-description">
    <!---   ------------------------ MESSAGE SIGANLEMENT----------------------------  -->
    {% if msg %}
    <div class="element message" style="background-color: yellow;">
        <div class="msg">
            {{msg|safe }}
        </div>
        <div>
            <span id="btn_message_fermer"  class="signaler">FERMER</span>
            {% if uid %}
                    <span id="btn-modal-message" onclick="btn_modal_signaler()" class="signaler">SIGNALER</span>
            {% else %}
                    <span id="btn-modal-message" onclick="btn_modal_message()" class="signaler">SIGNALER</span> 
            {% endif %}
        </div> 
    </div> 
    {% endif %}
    <!---   ------------------------ MESSAGE INDISPONIBILITE ---------------------------  -->
    {% if dispo.disponible == "Indisponible" %}
    <div class="element message" style="background-color: tomato;">
        <div class="msg" >
            Cette annonce n'est plus disponible! 
        </div>
        <div>
            <span id="btn_message_fermer"  class="signaler">FERMER</span>
        </div> 
    </div> 

    {% endif %}
    


   
    <!---   ------------------------ SECTION IMAGE----------------------------  -->
    <div class="element thumbail">
            <div class="mySlides">
                <div class="numbertext"> <i class="fas fa-image"></i> 1 / 3</div>
            {% if dat.imgurl1 %}
                <img class="demo cursor" src="{{dat.imgurl1}}" style="width:100%" height="350" onclick="currentSlide(1)" alt="{{dat.produit}}">
              {% else %}
              <img class="demo cursor" src="https://images.pexels.com/photos/375510/pexels-photo-375510.jpeg?auto=compress&cs=tinysrgb&w=600" style="width:100%" height="350" onclick="currentSlide(1)" alt="pexels">
              {% endif %}
            </div>
          
            <div class="mySlides">
              <div class="numbertext"> <i class="fas fa-image"></i> 2 / 3</div>
            {% if dat.imgurl2 %}
              <img class="demo cursor" src="{{dat.imgurl2}}" style="width:100%" height="350" onclick="currentSlide(1)" alt="{{dat.produit}}">
            {% else %}
            <img class="demo cursor" src="https://images.pexels.com/photos/375510/pexels-photo-375510.jpeg?auto=compress&cs=tinysrgb&w=600" height="350" style="width:100%" onclick="currentSlide(1)" alt="pexels">
            {% endif %}
            </div>
          
            <div class="mySlides">
              <div class="numbertext"> <i class="fas fa-image"></i> 3 / 3</div>
            {% if dat.imgurl3 %}
              <img class="demo cursor" src="{{dat.imgurl3}}" style="width:100%" height="350" onclick="currentSlide(1)" alt="{{dat.produit}}">
            {% else %}
            <img class="demo cursor" src="https://images.pexels.com/photos/375510/pexels-photo-375510.jpeg?auto=compress&cs=tinysrgb&w=600" style="width:100%" height="350" onclick="currentSlide(1)" alt="pexels">
            {% endif %}
            </div>  
            <a class="prev" onclick="plusSlides(-1)">❮</a>
            <a class="next" onclick="plusSlides(1)">❯</a>
          
            <div class="row">
              <div class="column">
                {% if dat.imgurl1 %}
                  <img class="demo cursor" src="{{dat.imgurl1}}" style="width:100%" height="100" onclick="currentSlide(1)" alt="{{dat.produit}}">
                {% else %}
                <img class="demo cursor" src="https://images.pexels.com/photos/375510/pexels-photo-375510.jpeg?auto=compress&cs=tinysrgb&w=600" style="width:100%" height="100" onclick="currentSlide(1)" alt="pexels">
                {% endif %}
              </div>
              <div class="column">
                {% if dat.imgurl2 %}
                  <img class="demo cursor" src="{{dat.imgurl2}}" style="width:100%" height="100" onclick="currentSlide(1)" alt="{{dat.produit}}">
                {% else %}
                <img class="demo cursor" src="https://images.pexels.com/photos/375510/pexels-photo-375510.jpeg?auto=compress&cs=tinysrgb&w=600" height="100" style="width:100%" onclick="currentSlide(1)" alt="pexels">
                {% endif %}
              </div>
              <div class="column">
              {% if dat.imgurl3 %}
                <img class="demo cursor" src="{{dat.imgurl3}}" style="width:100%" height="100" onclick="currentSlide(1)" alt="{{dat.produit}}">
              {% else %}
              <img class="demo cursor" src="https://images.pexels.com/photos/375510/pexels-photo-375510.jpeg?auto=compress&cs=tinysrgb&w=600" height="100" style="width:100%" onclick="currentSlide(1)" alt="pexels">
              {% endif %}
              </div>
             
          </div>
        
      </div>
    <!---   ------------------------ SECTION HOME ----------------------------  -->
    <div class="element pritidi">
        
        <div class="prix">
            {% if dat.prix %} 
                {{dat.prix}}
                {% if dat.devise == "USD"%}${% elif dat.devise == "CDF"%}Fc{% endif %}  
                <span  style="font-size:10px;">/{{dat.poids}}</span>
            {% endif %}
            
            {% if dat.prix_min %}
               {{dat.prix_min}} 
               {% if dat.devise == "USD"%}${% elif dat.devise == "CDF"%}Fc{% endif %}
            {% endif %}
            {% if dat.prix_min %}
              - {{dat.prix_max}}
              {% if dat.devise == "USD"%}${% elif dat.devise == "CDF"%}Fc{% endif %}
              <span  style="font-size:10px;">/{{dat.poids}}</span>
            {% endif %}

            {% if dat.autres %}
               {{dat.autres}}
            {% endif %} 
        </div>
        <div class="titre">{{dat.titre|title}}</div>
        <div class="disponibilite"style="color:{{dispo.color}}">{{dispo.disponible|default:"Delai"}}</div>
        <div class="stat">
            <span class="vu"><i class="fas fa-comments"></i> {{avis.count_total|default:"0"}}</span>
            <span class="vu"><i class="fas fa-eye"></i> {{vues.count|default:"0"}}</span>
        </div>
    </div>
    <!---   ------------------------ SECTION EVALUATION ----------------------------  -->
    <div class="element evaluation">
        <div class="element-titre">Evaluation du producteur</div>
        <div class="element-center">
            {% if evaluation <= 40 %}
            <div class="evaluation-nombre">          
                <div class="progressbar">
                    <div class="wrap-circles">
                        <div class="circle" style="background-image: conic-gradient(rgb(196, 29, 0) {{evaluation}}%, #000000 0);">
                            <div class="inner">{{evaluation}}</div>
                        </div>
                    </div>
            
                </div>
                <div class="evaluation-text" style="color:red;">Non Fiable</div>
            </div>
            {%else%}
                <div class="evaluation-nombre">
                    <div class="progressbar">
                        <div class="wrap-circles">
                            <div class="circle" style="background-image: conic-gradient(rgb(145, 255, 0) {{evaluation}}%, #000000 0);">
                                <div class="inner">{{evaluation}}</div>
                            </div>
                        </div>
                
                    </div>
                    <div class="evaluation-text" style="color:rgb(145, 255, 0);">Fiable</div>
                </div>
            {%endif%}
            <p>Cliquer Sur le Bouton ce desous Pour Evaluer</p>
                
            <div class="evaluation-center">
                {% if uid %}
                <div class="evaluation-btn" id="btn-modal-evaluation" onclick="btn_modal_evaluation()">Evaluer</div> 
                {% else %}
                <div class="evaluation-btn" id="btn-modal-message" onclick="btn_modal_message()" >Evaluer</div> 
                {% endif %}
                        
            </div>     
        </div>     
    </div>
    <!---   ------------------------ MODAL EVALUATION ----------------------------  -->
    <div class="modal-connexion" id="myModal">
        <!-- Modal content -->
        <div  class="modal-content">
            <div class="modal-header">
                <span class="close close-evaluation"> 
                    <span class="fermer" onclick="close_evaluation()">&times;</span>
                    <span class="text-search">Evaluation du Producteur</span>
                    <span></span>
                </span>
            </div>
            <div class="modal-body">
                    
                    <form id="evaluation-form"  method="post"  >
                        {% csrf_token %}
                        
                        <p class="text" style="color:tomato;">Cliquer sur "Fiable" ou sur "Non Faible" afin de Noter le Producteur</p>
                        <div class="part-evaluation">
                            <div id="uidannonce" data-uidannonce="{{user.uid}}"></div>
                            <div id="uid"  data-uid="{{uid}}" ></div>
                            <div class="fiable"">
                                <label>
                                   <input type="radio" id="fiable" name="evaluation" value="fiable">
                                   <span>Fiable</span> 
                                </label>
                            </div>
                            <div class="nofiable">
                                <label>
                                   <input type="radio" id="nofiable" name="evaluation" value="nofiable">
                                   <span>Non Fiable</span> 
                                </label>
                            </div>
                            <input type="submit" value="Evaluer">
                        </div>
                    </form>
         </div>   
    </div>
    </div>
    <!---   ------------------------ MODAL MESSAGE ----------------------------  -->
   
    <div class="modal-connexion" id="modal-messsage">
        <!-- Modal content -->
        <div  class="modal-content" style="height:250px;">
            <div class="modal-header">
                <span class="close close-message"> 
                    <span class="fermer"  onclick="close_message()">&times;</span>
                    <span class="text-search">Message</span>
                    <span></span>
                </span>
            </div>
            <div class="modal-body">
                    
                    <form id="evaluation-form"  method="post" data-uid="{{uid}}" >
                        {% csrf_token %}
                        
                        <p class="text" >Veillez vous connecter ou vous inscrire s'ils vous plait!</p>
                        <div class="part-evaluation">
                            <button onClick='window.location.href="/signIn/"'>Se Connecter</button>
                            <button style="background-color: var(--orange);border: 1px solid var(--orange);" onClick='window.location.href="/signUp/"'>Creer Un Compte</button>
                        </div>
                    </form>
         </div> 
           
    </div>
    </div>

   <!---   ------------------------ SECTION DETAILS ----------------------------  -->
    <div class="element details">
        <div class="element-titre">Details du produit</div>
        <ul>
            <li class="detail"><strong>Categorie:</strong>
                {%if dat.categorie == "agriculture"%}
                <a href="{% url 'agriculture' %}">{{dat.categorie|title}}</a>
                <span id="data-cat" data-cat="{{dat.categorie}}"></soan> 
                {%else %}
                <span id="data-cat" data-cat="{{dat.categorie}}"></span> 
                <a href="{% url 'elevage' %}">{{dat.categorie|title}}</a>
                {% endif%}
            </li>
            <li class="detail"><strong>Produit:</strong> {{dat.produit|title}}</li>
            <li class="detail"><strong>Quatite:</strong>{{dat.quatite}}</li>
            <li class="detail"><strong>Lieu:</strong>{{dat.lieu}}</li>
            <li class="detail"><strong>Date de Publication:</strong>{{dat.date}}</li>
        </ul>
    </div>
    <!---   ------------------------ SECTION DISCRIPTION ----------------------------  -->
    <div class="element description">
        <div class="element-titre">Description du produit</div>
        <p class="text">
            {{dat.description|title}}
        </p>
    </div>
    
<!---   ------------------------ SECTION FLOTANT FAVORIS  ----------------------------  -->
    <div class="description-contact">
        {% if uid %}
            {% if favoris %}
            <span  id="btn-modal-favoris-del" class="favoris" data-id="{{idannonce}}" ><i class="fas fa-trash"></i> Supprimer Au favoris</span>
            <span style="display:none" id="btn-modal-favoris-add" class="favoris" data-id="{{idannonce}}" ><i class="fas fa-star"></i> Ajouter Au favoris</span>
            {% else %}
            <span style="display:none" id="btn-modal-favoris-del" class="favoris" data-id="{{idannonce}}" ><i class="fas fa-trash"></i> Supprimer Au favoris</span>
            <span  id="btn-modal-favoris-add" class="favoris" data-id="{{idannonce}}" ><i class="fas fa-star"></i> Ajouter Au favoris</span>
            {% endif %}
        <span class="user-btn" onclick="btn_modal_contacter()"><div class="btn-contacter">Contact</div></span>
        {% else %}
        <span  onclick="btn_modal_message()" class="favoris"><i class="fas fa-star"></i> Ajouter Au favoris</span>
        <span  id="btn-modal-message" onclick="btn_modal_message()" class="user-btn"><div class="btn-contacter">Contacter</div></span>
        {% endif %}
        
    </div>

    
 <!---   ------------------------ SECTION COMMENTAIRE ----------------------------  -->
    <div class="element commentaire">
        <div class="element-titre">Avis sur le produit</div>
        <div class="note-produit">
            
            <div class="note"><i class="fa fa-star"></i> {{avis.moyen|default:"?"}}</div>
            
            <div class="etoile">
               <!-- Progress bar green -->
                    <div class="progress-bar--wrap progress-bar--yellow">
                        <div class="progress-bar">
                        Progress
                        <div class="progress-bar--inner" style="width: {{avis.pourcentage1}}%;"></div>
                        </div>
                        <span class="progress-bar--counter">({{avis.1|default:"?"}}) {{avis.pourcentage1|default:"?"}}% </span>
                    </div>
                    
                    <!-- Progress bar blue -->
                    <div class="progress-bar--wrap progress-bar--yellow">
                        <div class="progress-bar">
                        Progress
                        <div class="progress-bar--inner" style="width: {{avis.pourcentage2}}%;"></div>
                        </div>
                        <span class="progress-bar--counter">({{avis.2|default:"?"}}) {{avis.pourcentage2|default:"?"}}%</span>
                    </div>
                    
                    <!-- Progress bar red -->
                    <div class="progress-bar--wrap progress-bar--yellow">
                        <div class="progress-bar">
                        Progress
                        <div class="progress-bar--inner" style="width: {{avis.pourcentage3}}%;"></div>
                        </div>
                        <span class="progress-bar--counter">({{avis.3|default:"?"}}) {{avis.pourcentage3|default:"?"}}%</span>
                    </div>
                    
                    <!-- Progress bar yellow -->
                    <div class="progress-bar--wrap progress-bar--yellow">
                        <div class="progress-bar">
                        Progress
                        <div class="progress-bar--inner" style="width:{{avis.pourcentage4}}%;"></div>
                        </div>
                        <span class="progress-bar--counter">({{avis.4|default:"?"}}) {{avis.pourcentage4|default:"?"}}%</span>
                    </div>
                    
                    <!-- Progress bar yellow -->
                    <div class="progress-bar--wrap progress-bar--yellow">
                        <div class="progress-bar">
                        Progress
                        <div class="progress-bar--inner" style="width: {{avis.pourcentage5}}%;"></div>
                        </div>
                        <span class="progress-bar--counter">({{avis.5|default:"?"}}) {{avis.pourcentage5|default:"?"}}%</span>
                    </div>
            </div>
            <div class="commentaire-btn">
                {% if uid %}
                <span class="favoris" id="btn-modal-commentaire" onclick="btn_modal_avis()"> Donner Votre Avis</span>
                {% else %}
                <span class="favoris" id="btn-modal-message" onclick="btn_modal_message()">Donner Votre Avis</span> 
                {% endif %}
                 
            </div>
            
        </div>
        <div id="commentaire_promendite" class="commentaire_promendite">
            
        </div>
        <p id="chargement" style="color:red;font: size 20px;"  ></p>
        <div>
            <div id="btn_load_more_avis" class="btn_voir_plus_commentaire ">VOIR PLUS</div> 
        </div>  
    </div>
    
<!---   ------------------------ MODAL COMMENTAIRE ----------------------------  -->
    <div class="modal-connexion" id="modal-avis">
        <!-- Modal content -->
        <div  class="modal-content" id="screen-comentaire">
            <div class="modal-header">
                <span class="close "> 
                    <span class="fermer close-signaler" onclick="close_avis()">&times;</span>
                    <span class="text-search">Avis Sur Annonce</span>
                    <span></span>
                </span>
            </div>
            <div class="modal-body">
                    <h5 style="color:tomato;" class="text social" id="text-annonce">
                        Donner votre avis sur le produits. 
                    </h5>
                          <!--     form modal        -->
                        <form   id="avis-form" methode="post">
                            {% csrf_token %}
                            <div class="part part_signaler isactived">
                            <input id="titre_commentaire" type="text" placeholder="Titre(exemple:tres bon produits, c'est nul ...)" name="titre" > 
                            <div style="display:flex;align-items:center;">

                                <span id="idannonce" data-idannonce="{{idannonce}}"></span>
                                <label for="star" >Combien d'etoile? :</label>
                                <input type="radio" id="1" name="star"  value="1" style="width:20px;height:20px" required  checked>
                                <label for="1" ><i class="fa fa-star"></i> 1</label>
                                <input type="radio" id="2"  name="star"  value="2" style="width:20px;height:20px" required >
                                <label for="2" ><i class="fa fa-star"></i> 2</label>
                                <input type="radio" id="3"  name="star"  value="3" style="width:20px;height:20px" required >
                                <label for="3" ><i class="fa fa-star"></i> 3</label>
                                <input type="radio" id="4"  name="star"  value="4" style="width:20px;height:20px" required >
                                <label for="4" ><i class="fa fa-star"></i> 4</label>
                                <input type="radio" id="5"  name="star"  value="5" style="width:20px;height:20px" required >
                                <label for="5" ><i class="fa fa-star"></i> 5</label>
                              </div> 
                            <div id="textarea">
                                <textarea id="desc_commentaire"  rows="2" cols="50" name="signaler-autre" placeholder="description(exemple: j'ai beaucoup aime le produits ...) " ></textarea>
                            </div>
                            <p id="message_load_avis" style="text-align:centre;color:tomato;"></p>
                            <div class="btn">
                                <button>Envoyer</button>
                            </div>
                       </div>       
                        </form>   
                        
                     
                
         </div>   
    </div>
    </div>

 <!---   ----------------- SECTION SUIVRE et FOURNISSEUR --------------------  -->
    
    <div class="element contact" >
        <div style="cursor:pointer;" class="user-thumbails" onClick='window.location.href="/espacemembre/{{dat.uid}}/"'>
            {% if user.imgurl %}
            <img src="{{user.imgurl}}" alt="{{user.prenom}}" class="user-img" height="80" width="80">
            {% else %}
            <img class="user-img" src="https://th.bing.com/th/id/OIP.iOnAhgLrg_AR5D6STimV3wAAAA?w=221&h=220&c=7&r=0&o=5&pid=1.7" width="80" height="80" alt="">
            {% endif%}
        </div>
        <div class="user-name">
            <span class="name">{{user.prenom|default:"Prenom"}} {{user.nom |default:"Nom"}}</span>
        </div>
        <div class="user-entreprise">
            <span class="name">{{user.entreprise|default:"Entreprise"|title}} </span>
        </div>
       
        {% if uid %}
        
        <div style="display:none;" id="btn-modal-follow-del" class="follow"><p><i class="fas fa-trash"></i>  Ne plus Suivre</p></div>
        <div id="btn-modal-follow-add" class="follow"><p><i class="fas fa-bookmark"></i> Suivre</p></div>
        {% else %}
        <div  class="follow"><p onclick="btn_modal_message()" ><i class="fas fa-bookmark"></i> Suivre</p></div>
        {% endif %}
    </div>
   

<!---   ----------------- SECTION SIGNALER --------------------  -->
    <div class="element control">
        {% if uid %}
                <span id="btn-modal-message" onclick="btn_modal_signaler()" class="signaler">SIGNALER</span>
        {% else %}
                <span id="btn-modal-message" onclick="btn_modal_message()" class="signaler">SIGNALER</span> 
        {% endif %}
             
    </div> 
   </div> 
<!---   -------------------------------------RECOMMANDER ----------------------------------  -->
    <div class="recommandation" style="width:100%;background-color: rgb(210, 204, 223);">
        <div class="info">
            <h2 style="text-align: center;">Même Categorie </h2>
        </div>
        <div class=" owl-carousel owl-theme">
            {% for iden, work,user,dispo in list %}
            <div class="item">
                <!-- Post-->
            <div class="post-module">
                <!-- Thumbnail-->
                <div class="thumbnail" onClick='window.location.href="/description/{{work.categorie}}/{{iden.id}}"'>
                {% if work.imgurl1 %}
                    <img src="{{work.imgurl1}}" alt="" class="card-image" height="450" width="500">
                 {% elif work.imgurl2 %}
                    <img src="{{work.imgurl2}}" alt="" class="card-image" height="450" width="500">
                 {% elif work.imgurl3 %}
                    <img src="{{work.imgurl3}}" alt="" class="card-image" height="450" width="500" >
                 {% else %}
                   <img src="https://images.pexels.com/photos/375510/pexels-photo-375510.jpeg?auto=compress&cs=tinysrgb&w=600" alt="" class="card-image" height="620" width="620">
                 {%endif%}
                </div>
                <!-- Post Content-->
                <div class="post-content">
                <div class="category">{{work.categorie}}</div>
                <h1 class="title">{{work.titre|title|truncatechars:20 }}</h1>
                <div class="prix">
                    {% if work.prix %} 
                        {{work.prix}}
                        {% if work.devise == "USD"%}${% elif work.devise == "CDF"%}Fc{% endif %}  
                        <span  style="font-size:10px;">/{{work.poids}}</span>
                    {% endif %}
                    
                    {% if work.prix_min %}
                       {{work.prix_min}} 
                       {% if work.devise == "USD"%}${% elif work.devise == "CDF"%}Fc{% endif %}
                    {% endif %}
                    {% if work.prix_min %}
                      - {{work.prix_max}}
                      {% if work.devise == "USD"%}${% elif work.devise == "CDF"%}Fc{% endif %}
                      <span  style="font-size:10px;">/{{work.poids}}</span>
                    {% endif %}
        
                    {% if work.autres %}
                       {{work.autres}}
                    {% endif %} 
                </div>
                <h2 class="sub_title" style="color:{{dispo.color}}">{{dispo.disponible|default:"Delai"}}</h2>
                <p class="description">{{work.description|truncatechars:100}}</p>
                <div class="post-meta">
                    <span class="timestamp"><i class="fas fa-clock"></i>{{work.date}}</span>
                    <span class="users"><i class="fas fa-users"></i>{{user.prenom}} {{user.nom}}</span>
                    <span  class="lieu"><i class="fas fa-map-marker-alt"></i>{{user.quartier}}</span>
                </div>
                </div>
                <div class="post-click">
                    <p  onClick='window.location.href="/description/{{work.categorie}}/{{iden.id}}"'>Voir Plus</p>
                </div>
            </div>
            </div>
           {% empty %}
            
            <div class="item">
                <div class="post-module">
                    <!-- Thumbnail-->
                    <div class="thumbnail">
                    <img src="img/champ.jpg" height="500"/>
                    </div>
                    <!-- Post Content-->
                    <div class="post-content">
                    <div class="category">Elevage</div>
                    <h1 class="title">Vente des Montons a panda makomemo venez </h1>
                    <h2 class="sub_title">Disponible</h2>
                    <p class="description">New York, the largest city in the U.S., is an architectural marvel with plenty of historic monuments, magnificent buildings and countless dazzling skyscrapers.</p>
                    <div class="post-meta">
                        <span class="timestamp"><i class="fas fa-clock"></i>6 mins ago</span>
                        <span class="users"><i class="fas fa-users"></i>mike sindani</span>
                        <span  class="lieu"><i class="fas fa-map-marker-alt"></i>kasumbalesha</span>
                    </div>
                    </div>
                    <div class="post-click">
                    <p>Voir Plus</p>
                    </div>
                </div>
            </div>
            <div class="item">
                <div class="post-module">
                    <!-- Thumbnail-->
                    <div class="thumbnail">
                    <img src="img/champ.jpg" height="500"/>
                    </div>
                    <!-- Post Content-->
                    <div class="post-content">
                    <div class="category">Elevage</div>
                    <h1 class="title">Vente des Montons a panda makomemo venez </h1>
                    <h2 class="sub_title">Disponible</h2>
                    <p class="description">New York, the largest city in the U.S., is an architectural marvel with plenty of historic monuments, magnificent buildings and countless dazzling skyscrapers.</p>
                    <div class="post-meta">
                        <span class="timestamp"><i class="fas fa-clock"></i>6 mins ago</span>
                        <span class="users"><i class="fas fa-users"></i>mike sindani</span>
                        <span  class="lieu"><i class="fas fa-map-marker-alt"></i>kasumbalesha</span>
                    </div>
                    </div>
                    <div class="post-click">
                    <p>Voir Plus</p>
                    </div>
                </div>
            </div>
            <div class="item">
                <div class="post-module">
                    <!-- Thumbnail-->
                    <div class="thumbnail">
                    <img src="img/champ.jpg" height="500"/>
                    </div>
                    <!-- Post Content-->
                    <div class="post-content">
                    <div class="category">Elevage</div>
                    <h1 class="title">Vente des Montons a panda makomemo venez </h1>
                    <h2 class="sub_title">Disponible</h2>
                    <p class="description">New York, the largest city in the U.S., is an architectural marvel with plenty of historic monuments, magnificent buildings and countless dazzling skyscrapers.</p>
                    <div class="post-meta">
                        <span class="timestamp"><i class="fas fa-clock"></i>6 mins ago</span>
                        <span class="users"><i class="fas fa-users"></i>mike sindani</span>
                        <span  class="lieu"><i class="fas fa-map-marker-alt"></i>kasumbalesha</span>
                    </div>
                    </div>
                    <div class="post-click">
                    <p>Voir Plus</p>
                    </div>
                </div>
            </div>
            <div class="item">
                <div class="post-module">
                    <!-- Thumbnail-->
                    <div class="thumbnail">
                    <img src="img/champ.jpg" height="500"/>
                    </div>
                    <!-- Post Content-->
                    <div class="post-content">
                    <div class="category">Elevage</div>
                    <h1 class="title">Vente des Montons a panda makomemo venez </h1>
                    <h2 class="sub_title">Disponible</h2>
                    <p class="description">New York, the largest city in the U.S., is an architectural marvel with plenty of historic monuments, magnificent buildings and countless dazzling skyscrapers.</p>
                    <div class="post-meta">
                        <span class="timestamp"><i class="fas fa-clock"></i>6 mins ago</span>
                        <span class="users"><i class="fas fa-users"></i>mike sindani</span>
                        <span  class="lieu"><i class="fas fa-map-marker-alt"></i>kasumbalesha</span>
                    </div>
                    </div>
                    <div class="post-click">
                    <p>Voir Plus</p>
                    </div>
                </div>
            </div>
        {%endfor%}
           
        </div>
    </div>

<!---   ------------------------ MODAL CONTATER ----------------------------  -->
 
<div class="modal-connexion" id="modal-contacter">
    <!-- Modal content -->
    <div  class="modal-content" id="screen-contact">
        <div class="modal-header">
            <span class="close "> 
                <span class="fermer close-contacter" onclick="close_contacter()">&times;</span>
                <span class="text-search">Contact du producteur</span>
                <span></span>
            </span>
        </div>
        <div class="modal-body">
                <h5 style="color:tomato;" class="text social" id="text-annonce">
                    Voici les contacter du producteur ou fournisseur.
                </h5>
                <form action="/creation_annonce/" method="post" >
                    {% csrf_token %}
                    <div class="part_item">
                        <div class="item item1 isactived-item" id="item1" onclick="change_section(1)">A propos</div>
                        <div class="item item2 " id="item2" onclick="change_section(2)" >Contacts</div>
                        <div class="item item3" id="item3" onclick="change_section(3)" >Adresses</div>
                    </div>
                    
                    <div class="section part_info isactived">
                        <div class="img-profil"><img src="{{user.imgurl}}" alt="" width="100" height="100"></div>
                        <div class="txt"> <strong> {{user.prenom}} {{user.nom}}  </strong></div>
                        <div class="txt"> <strong> {{user.entreprise}} </strong></div>
                         
                    </div>
                    <div class="section part_info_2">

                        <div class="txt"><a href="mailto:{{user.email}}"><i class="fas fa-envelope"></i> email: {{user.email}}</a></div>
                        <div class="txt"><a href="tel:{{user.tel1}}"> <i class="fa fa-phone" aria-hidden="true"></i> <strong>Numero de telephone 1 :</strong> {{user.tel1}}</a></div>
                        <div class="txt"><a href="tel:{{user.tel2}}"> <i class="fa fa-phone" aria-hidden="true"></i></i> <strong>Numero de telephone 2 :</strong> {{user.tel2}}</a></div> 
                        <div class="txt"><a href="https://t.me/{{user.telegram}}"><i class="fab fa-telegram-plane"></i> <strong>Telegram : </strong> {{user.telegram}}</a></div> 
                        <div class="txt"><a href="https://api.whatsapp.com/send?phone=243{{user.whatsapp}}"><i class="fab fa-whatsapp" aria-hidden="true"></i> <strong>Whatsapp : </strong> {{user.whatsapp}}</a></div>               
                    </div>
                    <div class="section part_info_3">

                        <div class="txt"> <strong>Commune : </strong> {{user.commune}}</div>
                        <div class="txt"><strong>Quartier :</strong>  {{user.quartier}}</div>
                        <div class="txt"> <strong>Avenue : </strong> {{user.avenue}}</div> 
                            
                    </div> 
                     
                </form>
     </div>   
</div>
</div>

<!-------------------- MODAL SIGNALER -------------------------->
<div class="modal-connexion" id="modal-signaler">
    <!-- Modal content -->
    <div  class="modal-content" id="screen-contact">
        <div class="modal-header">
            <span class="close "> 
                <span class="fermer close-signaler" onclick="close_signaler()">&times;</span>
                <span class="text-search">Signaler Cette Annonce</span>
                <span></span>
            </span>
        </div>
        <div class="modal-body">
                <h5 style="color:tomato;" class="text social" id="text-annonce">
                    Selectionner la raison ou ecrivez-nous pour autres raison consernants.
                </h5>
                      <!--     form modal        -->
                    <form action="/signaler_annonce/{{idannonce}}/{{user.uid}}/{{categorie}}/"  id="signaler-form" methode="get">
                        {% csrf_token %}
                        <div class="part part_signaler isactived">
                        <select id="cat" name="motif">
                            <option value="Indesirable">Indesirable</option>
                            <option value="Arnaque">Arnaque</option>
                            <option value="Faux compte">Faux compte</option>
                            <option value="Pornagaphique">Pornogaphique</option>
                            <option value="Mauvaise Categorie">Mauvaise Categorie</option>
                            <option value="Autres">Autres</option>

                        </select> 
                        <div id="textarea">
                            <textarea  rows="2" cols="50" name="signaler-autre" placeholder="Autres raisons " ></textarea>
                        </div>
                        <div class="btn">
                            <button>Signaler</button>
                        </div>
                   </div>       
                    </form>   
                    
                 
            
     </div>   
</div>
</div>

<!---   ------------------------ MODAL MESSAGE AUTRE----------------------------  -->
   
<div class="modal-connexion" id="modal-messsage-systeme">
    <!-- Modal content -->
    <div  class="modal-content" style="height:160px;">
        <div class="modal-header">
            <span class="close close-message"> 
                <span class="fermer"  onclick="close_message_systeme()">&times;</span>
                <span class="text-search">Message</span>
                <span></span>
            </span>
        </div>
        <div class="modal-body"> 
                <form id="evaluation-form"  method="post" data-uid="{{uid}}" >
                    {% csrf_token %}
                    <div style="text-align: center;cursor:pointer;">
                        <p id="message_systeme" ></p>
                        <span id="btn_message_fermer"  class="signaler"><strong>FERMER</strong> </span>
                    </div>
                    
                </form>
       </div>      
</div>
</div>


{%endfor %}
{%block js %} 

<script src="{% static 'description/js/description.js' %}"></script>
<script src="{% static 'owl-carrousel/js/card.js' %}"></script>
<script>

// ---------- SIGNALER MODAL FORM ON CHANGE ---------------
 
var select = document.querySelector('#signaler-form');
var textarea = document.querySelector('#textarea');
select.addEventListener('change', function () {
    console.log(this.value)
            if(this.value=="Autres"){
                textarea.style.display = block;
            }else{
                textarea.style.display = none;
            }
});
// ----------- SECTION  --------------------
function change_section(number){
    if (number==1){
        $(".part_info").css("display","block");
        $(".part_info_2").css("display","none");
        $(".part_info_3").css("display","none");
        $("#item1").css("color","black");
        $("#item2").css("color","gray");
        $("#item3").css("color","gray");
    }
    if (number==2){
        $(".part_info").css("display","none");
        $(".part_info_2").css("display","block");
        $(".part_info_3").css("display","none");
        $("#item2").css("color","black");
        $("#item1").css("color","gray");
        $("#item3").css("color","gray");
       
    }
    if (number==3){
        $(".part_info").css("display","none");
        $(".part_info_2").css("display","none");
        $(".part_info_3").css("display","block");
        $("#item3").css("color","black");
        $("#item1").css("color","gray");
        $("#item2").css("color","gray");
    }
}

// ----------- MODAL CONTACTER-------------------
     // Get the modal
var modalContacter = document.getElementById("modal-contacter");

// Get the button that opens the modal
function btn_modal_contacter() {
modalContacter.style.display = "block";
}

// Get the <span> element that closes the modal
function close_contacter() {
modalContacter.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
if (event.target == modalContacter) {
    modalContacter.style.display = "none";
}
}

// ----------- MODAL Commentaire-------------------
     // Get the modal
     var modalAvis = document.getElementById("modal-avis");

// Get the button that opens the modal
function btn_modal_avis() {
    modalAvis.style.display = "block";
}

// Get the <span> element that closes the modal
function close_avis() {
    modalAvis.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
if (event.target == modalAvis) {
    modalAvis.style.display = "none";
}
}
// ----------- MODAL MESSAGE-------------------
     // Get the modal
var modalmessage = document.getElementById("modal-messsage");

// Get the button that opens the modal
function btn_modal_message() {
modalmessage.style.display = "block";
}

// Get the <span> element that closes the modal
function close_message() {
modalmessage.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
if (event.target == modalmessage) {
    modalmessage.style.display = "none";
}
}
// ----------- MODAL MESSAGE SYSTEME -------------------
     // Get the modal
     var modalmessagesys = document.getElementById("modal-messsage-systeme");


// Get the <span> element that closes the modal
function close_message_systeme() {
modalmessagesys.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
if (event.target == modalmessagesys) {
    modalmessagesys.style.display = "none";
}
}
/* ----------- MODAL EVALUATION -------------------*/
 /*Get the modal*/
 var modalevaluatiion = document.querySelector("#myModal");

/* Get the button that opens the modal*/
function btn_modal_evaluation() {
    modalevaluatiion.style.display = "block";
}

 /*Get the <span> element that closes the modal*/
function close_evaluation() {
modalevaluatiion.style.display = "none";
}


// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
if (event.target == modalevaluatiion) {
    modalevaluatiion.style.display = "none";
}
}

// ------------------- Ajax pour evaluation -------------------------------
$(document).on('submit', '#evaluation-form', function(e){
e.preventDefault();
var evaluation = document.querySelector('input[name="evaluation"]:checked').id;

//name = $('#fiable').val()
//name = $('#nofiable').val()
uidannonce = $("#uidannonce").attr("data-uidannonce");
uid = $("#uid").attr("data-uid");
console.log(evaluation);
console.log(uidannonce);
console.log(uid);
$.ajax({
type: 'POST',
url: "{% url 'evaluation' %}",
data: {
    evaluation: evaluation,
    uidannonce: uidannonce,
    uid: uid,
    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
},
success: function(data) {
    document.getElementById("modal-messsage-systeme").style.display = "block"
    document.getElementById("message_systeme").textContent = data
    setInterval(function(){
                document.getElementById("modal-messsage-systeme").style.display = "none"
    },5000);
    modalevaluatiion.style.display = "none";
    window.location.reload();
 
},
})
   
});




// ---------- affichage des commentataire --------
var commentaireBox = document.getElementById('commentaire_promendite');
var visible = 1
var chargementBox = document.getElementById("chargement");
var idannonce = $("#idannonce").attr("data-idannonce");
var loadBtn = document.getElementById("btn_load_more_avis");
chargementBox.textContent="CHARGEMENT DES COMMENTAIRES EN COURS ... "   
var get_commentaire = () => {
     
    $.ajax({
        type: 'GET',
        url: `/get_commentaire/${idannonce}/${visible}/`,
        success: function(response){
            console.log(response)
            var data = response.data
            setTimeout(()=>{
                
                console.log(data)
                
                //const donnee = new Array(data);
            
                data.forEach(el=> {
                    commentaireBox.innerHTML += `
                    <div class="commentaire_items">
                        <div class="nom_star">${el.nom} ${el.prenom}<span class="nom"></span><span class="star"><i class="fa fa-star"></i>${el.star}</span></div>
                        <div class="titre">${el.titre}</div>
                        <div class="avis">${el.description}</div>
                        <div class="date_publication">${el.date}</div>
                    </div>   
                    `
                });
                
            }, 1000)
            chargementBox.textContent=""
            console.log(response.size)
            if (response.size === 0) {
                chargementBox.textContent = 'Pas de commentaire'
            }
            else if (response.size <= visible) {
                loadBtn.classList.add('not-visible')
                chargementBox.textContent = 'Il y a plus de commantaire...'
            }
        },
        error: function(error){
            console.log(error)
        }
    })
       
}

loadBtn.addEventListener('click', ()=>{
    //spinnerBox.classList.remove('not-visible')
    chargementBox.textContent="CHARGEMENT DES COMMENTAIRES EN COURS ... " 
    visible += 1
    get_commentaire()
})



// ----------- MODAL SiGNALER-------------------
    // Get the modal
var modalSignaler = document.getElementById("modal-signaler");

// Get the button that opens the modal
function btn_modal_signaler() {
    modalSignaler.style.display = "block";
}

// Get the <span> element that closes the modal
function close_signaler() {
    modalSignaler.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
if (event.target == modalSignaler) {
    modalSignaler.style.display = "none";
}}

$("#btn_message_fermer").click(function (){
   $(".message").css("display","none");
  });



// pour execute la fontion afin de charge les elements 
get_commentaire()



// ------------ code ajouter commmaentaire ----------------------

$(document).on('submit', '#avis-form', function(e){
        e.preventDefault();
        document.getElementById("message_load_avis").textContent = "ENVOI EN COURS ...";
        var star = document.querySelector('input[name="star"]:checked').id;
        // on recupere les donnes 
        titre_commentaire = $('#titre_commentaire').val()
        desc_commentaire = $('#desc_commentaire').val()
        uidannonce = $("#uidannonce").attr("data-uidannonce");
        idannonce = $("#idannonce").attr("data-idannonce");
        uid = $("#uid").attr("data-uid");

        // on test 
        console.log(star);
        console.log(titre_commentaire);
        console.log(desc_commentaire);
        console.log(uidannonce);
        console.log(idannonce);
        console.log(uid);
        $.ajax({
        type: 'POST',
        url: "{% url 'create_commentaire' %}",
        data: {
            titre: titre_commentaire,
            description: desc_commentaire,
            star: star,
            uidannonce: uidannonce,
            idannonce: idannonce,
            uid: uid,
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) {
            // ON AFFICHE LA BOITE DE DIALOGE MESSAGE 
            document.getElementById("modal-messsage-systeme").style.display = "block"
            document.getElementById("message_systeme").textContent = data
            setInterval(function(){
                document.getElementById("modal-messsage-systeme").style.display = "none"
            },5000);
            window.location.reload();
        },
        })
        document.getElementById("message_load_avis").textContent = "ENVOI TERMINE..."; 
        setInterval(function(){
            document.getElementById("message_load_avis").textContent = " "; 
            modalAvis.style.display = "none";
            get_commentaire()

        },5000)
        
});
//----------- AJOUTE FAVORIS ------------------
user_id = $("#uid").attr("data-uid");
$('#btn-modal-favoris-add').click(function(){
    //var catid;
    //id = $(this).attr("data-id");
    console.log(user_id)
    $.ajax(
    {   
        type:"GET",
        url: `/set_favoris/${idannonce}/${user_id}/`,
        success: function( data ) 
        {   
            //$( '#like').remove();
            //$( '#message' ).text(data);
            $('#btn-modal-favoris-del').css("display","block");
            $('#btn-modal-favoris-add').css("display","none");
            
            document.getElementById("modal-messsage-systeme").style.display = "block"
            document.getElementById("message_systeme").textContent = data
            setInterval(function(){
                document.getElementById("modal-messsage-systeme").style.display = "none"
            },5000);
        }
     })
});

  $('#btn-modal-favoris-del').click(function(){
    //var catid;
    //id = $(this).attr("data-id");
    console.log(user_id)
    $.ajax(
    {   
        type:"GET",
        url: `/get_favoris/${idannonce}/${user_id}/`,
        success: function( data ) 
        {   

            $('#btn-modal-favoris-del').css("display","none");
            $('#btn-modal-favoris-add').css("display","block");

            document.getElementById("modal-messsage-systeme").style.display = "block"
            document.getElementById("message_systeme").textContent = data
            setInterval(function(){
                document.getElementById("modal-messsage-systeme").style.display = "none"
            },5000);

        }
     })
});

// ------------- code pour le botton add follow ---------------------------
uidannonce = $("#uidannonce").attr("data-uidannonce");
$('#btn-modal-follow-add').click(function(){
    //var catid;
    //id = $(this).attr("data-id");
    console.log(user_id)
    console.log(uidannonce)
    $.ajax(
    {   
        type:"GET",
        url: `/add_follow/${uidannonce}/${user_id}/`,
        success: function( data ) 
        {   

            $('#btn-modal-follow-del').css("display","block");
            $('#btn-modal-follow-add').css("display","none");

            document.getElementById("modal-messsage-systeme").style.display = "block"
            document.getElementById("message_systeme").textContent = data
            setInterval(function(){
                document.getElementById("modal-messsage-systeme").style.display = "none"
            },5000);
            


        }
     })
});
</script>
{%endblock js %}
{% endblock Content %}